<!DOCTYPE html>
<html>
<meta charset="utf-8"/>
<title>注册</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<meta http-equiv="Expires" CONTENT="-1">
<meta http-equiv="Cache-Control" CONTENT="no-cache">
<meta http-equiv="Pragma" CONTENT="no-cache">
<link rel="stylesheet" href="/css/g.css">
<link rel="stylesheet" href="/css/public.css">
<link rel="stylesheet" href="/css/home.css">

<link rel="stylesheet" href="/css/register.css">
<script src="/js/zepto.min.js" type="text/javascript"></script>
<script src="/js/jquery.min.js" type="text/javascript"></script>

<body onload="_load()">
<!--html start-->
<div class="page">
    <header class="header">
        <a href="javascript:history.go(-1)" class="back comm_20_down"></a> 注册
    </header>
    <div class="register">


        <div class="tip">
            <div class="tip1">温馨提示</div>
            <div class="tip2">请妥善管理您的密码</div>
        </div>
        <div class="form">
            <form id="register_form" action="/users/register" method="post">
                <ul>

                    <li>
                        <i>
                            <img src="/image/用户.png" height="19px" width="19px">
                        </i>
                        <input class="mip" type="input" id="userName" name="userName" placeholder="请输入用户名"
                               onblur="_validateUserName()">
                        <div class="merr hide" id="userNameTip">此处为必填项</div>
                    </li>

                    <li>
                        <i>
                            <img src="/image/密码.png" height="19px" width="19px">
                        </i>
                        <input class="mip" type="input" id="passWord" name="password" placeholder="请输入密码"
                               onblur="_validatePassword()">
                        <div class="merr hide" id="passWordTip">此处为必填项</div>
                    </li>

                    <li>
                        <i>
                            <img src="/image/性别.png" width="19px" height="19px">
                        </i>
                        <input class="mip" type="input" id="sex" placeholder="性别" name="sex" onblur="_validateSex()">
                        <div class="merr hide" id="sexTip">此处为必填项</div>
                    </li>

                    <li>
                        <i>
                            <img src="http://s.demo.shangquanquan.com/wx/img/baolong/html5/register/yzm.png">
                        </i>
                        <input class="mip" type="input" id="birthday" name="birthday" placeholder="生日"
                               onblur="_validateBirthday()">
                        <div class="merr hide" id="birthdayTip">此处为必填项</div>
                    </li>

                    <li>
                        <i>
                            <img src="/image/手机.png" width="19px" height="19px">
                        </i>
                        <input class="mip" type="input" id="phone" name="phone" placeholder="手机"
                               onblur="_validatePhone()">
                        <div class="merr hide" id="phoneTip">此处为必填项</div>
                    </li>


                    <li>
                        <div>
                            <input class="mbt1" id="j_sb" type="button" onclick="_submit()" value="注册">
                        </div>
                    </li>

                </ul>
            </form>
        </div>
    </div>

    #include("foot.vm")
</div>

<!--html end-->
<script type="text/javascript">

    var _load = function () {
        var userName = jQuery('#userName').val();
        userName.onblur = function () {
            _validateUserName(this);
        };
        var password = jQuery('#passWord').val();
        password.onblur = function () {
            _validatePassword(this);
        };
        var sex = jQuery('#sex').val();
        sex.onblur = function () {
            _validateSex(this);
        };
        var birthday = jQuery('#birthday').val();
        birthday.onblur = function () {
            _validateBirthday(this);
        };
        var phone = jQuery('#phone').val();
        phone.onblur = function () {
            _validatePhone(this);
        };
    };

    var _showErrorMessage = function (messId, message, show) {
        if (messId == null) return;
        var Tip = document.getElementById(messId);
        if (show === true) {
            Tip.setAttribute("class", "merr");
            Tip.innerHTML = message;
        } else {
            Tip.setAttribute("class", "merr hide");
        }
    };


    var _validateUserName = function () {
        var userName = jQuery('#userName').val();
        if (userName == null | userName.length == 0) {
            _showErrorMessage("userNameTip", "用户名不能为空！", true);
            userName.focus();
            return;
        }
        var url = '//127.0.0.1/users/userName';
        $.ajax({
            url: url,
            type: 'GET',
            data: {
                userName: userName
            },
            dataType: 'json',
            success: function (data) {
                var json = JSON.stringify(data);
                var jsonObject = JSON.parse(json);
                if (jsonObject.code == 200) {
                    if (!jsonObject.data) {
                        _showErrorMessage("userNameTip", "用户名已存在！", true);
                        userName.focus();
                        return;
                    }
                    _showErrorMessage('userNameTip', false);
                } else {
                    alert("参数错误")
                }
            },
            error: function () {
                alert("出错了");
            }
        })
    }

    var _validatePassword = function () {
        var password = jQuery('#passWord').val();
        if (password == null) {
            _showErrorMessage("passWordTip", "密码不能为空！", true);
            password.focus();
            return;
        }
        if (password.length < 6) {
            _showErrorMessage("passWordTip", "密码不能少于6位！", true);
            password.focus();
            return;
        }
        _showErrorMessage('passWordTip', false);
    }

    var _validateSex = function () {
        var sex = jQuery('#sex').val();
        if (sex == null | sex.length == 0) {
            _showErrorMessage("sexTip", "性别不能为空！", true);
            sex.focus();
            return;
        }
        _showErrorMessage('sexTip', false);
    }


    var _validatePhone = function () {
        var phone = jQuery('#phone').val();

        if (phone.length == 0) {
            _showErrorMessage("phoneTip", '请输入手机号码！', true);
            phone.focus();
            return;
        }
        if (phone.length != 11) {
            _showErrorMessage("phoneTip", '请输入有效的手机号码！', true);
            phone.focus();
            return;
        }

        var phoneReg = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
        if (!phoneReg.test(phone)) {
            _showErrorMessage("phoneTip", '请输入有效的手机号码！', true);
            phone.focus();
            return;
        }

        _showErrorMessage("phoneTip", false);
    }

    var _validateBirthday = function () {
        var birthday = jQuery('#birthday').val();

        if (birthday == null | birthday.length == 0) {
            _showErrorMessage("birthdayTip", "生日不能为空！", true);
            birthday.focus();
            return;
        }
        _showErrorMessage('birthdayTip', false);
    }

    var _submit = function () {

        var userName = jQuery('#userName').val();
        if (userName == null | userName.length == 0) {
            _showErrorMessage("userNameTip", "用户名不能为空！", true);
            userName.focus();
            return;
        }
        var url = '//127.0.0.1/users/userName';
        $.ajax({
            url: url,
            type: 'GET',
            data: {
                userName: userName
            },
            dataType: 'json',
            success: function (data) {
                var json = JSON.stringify(data);
                var jsonObject = JSON.parse(json);
                if (jsonObject.code == 200) {
                    if (!jsonObject.data) {
                        _showErrorMessage("userNameTip", "用户名已存在！", true);
                        userName.focus();
                        return;
                    }
                    _showErrorMessage('userNameTip', false);
                } else {
                    alert("参数错误")
                }
            },
            error: function () {
                alert("出错了");
            }
        })

        var passWord = jQuery('#passWord').val();
        if (passWord == null) {
            _showErrorMessage("passWordTip", "密码不能为空！", true);
            passWord.focus();
            return;
        }
        if (passWord.length < 6) {
            _showErrorMessage("passWordTip", "密码不能少于6位！", true);
            passWord.focus();
            return;
        }


        var sex = jQuery('#sex').val();
        if (sex == null | sex.length == 0) {
            _showErrorMessage("sexTip", "性别不能为空！", true);
            sex.focus();
            return;
        }
        _showErrorMessage('sexTip', false);

        var birthday = jQuery('#birthday').val();
        if (birthday == null | sex.birthday == 0) {
            _showErrorMessage("birthdayTip", "生日不能为空！", true);
            sex.focus();
            return;
        }
        _showErrorMessage('birthdayTip', false);

        var phone = jQuery('#phone').val();
        if (phone.length == 0) {
            _showErrorMessage("phoneTip", '请输入手机号码！', true);
            phone.focus();
            return;
        }
        if (phone.length != 11) {
            _showErrorMessage("phoneTip", '请输入有效的手机号码！', true);
            phone.focus();
            return;
        }
        var phoneReg = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
        if (!phoneReg.test(phone)) {
            _showErrorMessage("phoneTip", '请输入有效的手机号码！', true);
            phone.focus();
            return;
        }
        _showErrorMessage("phoneTip", false);

        jQuery('#register_form').submit();
    };

</script>
</body>
</html>